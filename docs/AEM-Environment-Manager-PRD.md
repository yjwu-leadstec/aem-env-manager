# 产品需求文档

## AEM Environment Manager

**AEM 本地开发环境管理工具**

---

| 属性 | 内容 |
|------|------|
| 版本 | 1.0 |
| 日期 | 2025年1月 |
| 状态 | 草案 |

---

## 文档信息

| 属性 | 内容 |
|------|------|
| 文档名称 | AEM Environment Manager 产品需求文档 |
| 版本号 | 1.0 |
| 创建日期 | 2025年1月 |
| 文档状态 | 草案 |
| 目标平台 | macOS / Windows |

### 修订历史

| 版本 | 日期 | 修改内容 | 作者 |
|------|------|---------|------|
| 1.0 | 2025-01 | 初始版本 | - |

---

## 1. 概述

### 1.1 产品背景

AEM (Adobe Experience Manager) 开发人员在日常工作中经常需要在不同项目之间切换，每次切换都需要手动调整多项配置：

- Maven settings.xml 配置（不同项目可能使用不同的 Nexus 仓库和认证信息）
- Java 版本（AEM 6.5 使用 Java 8/11，AEM Cloud 使用 Java 11）
- Node.js 版本（不同前端项目依赖不同版本）
- AEM 实例连接（不同项目对应不同的本地实例）

这些手动操作繁琐且容易出错，严重影响开发效率。本产品旨在提供一个统一的图形化界面，让开发者能够一键切换完整的开发环境配置。

### 1.2 产品定位

AEM Environment Manager 是一款面向 AEM 开发人员的桌面应用程序，提供以下核心价值：

- **环境配置文件化**：将 Java、Node、Maven、AEM 实例等配置保存为 Profile
- **一键切换**：通过选择 Profile 一键切换整套开发环境
- **可视化管理**：直观显示 AEM 实例状态、版本信息
- **跨平台支持**：同时支持 macOS 和 Windows

### 1.3 目标用户

主要目标用户为 AEM 开发人员，包括：

- 需要同时维护多个 AEM 项目的开发者
- 需要在 AEM 6.5 和 AEM Cloud 之间切换的开发者
- 团队中需要统一环境配置的技术负责人

---

## 2. 功能需求

### 2.1 功能概览

| 功能模块 | 优先级 | 描述 |
|---------|--------|------|
| 首页仪表盘 | P0 | 显示当前环境状态概览，提供快速切换入口 |
| 环境配置管理 | P0 | 创建、编辑、删除、切换 Profile |
| AEM 实例管理 | P0 | 管理本地 AEM 实例，显示版本和状态 |
| Java 版本管理 | P0 | 扫描、切换 Java 版本 |
| Node 版本管理 | P0 | 扫描、切换 Node 版本 |
| Maven 配置管理 | P0 | 管理多套 Maven settings.xml |
| 全局设置 | P1 | 路径配置、同步设置、主题等 |
| 数据管理 | P1 | 导入导出配置、重置功能 |
| 首次使用向导 | P0 | 引导用户完成初始化配置 |

### 2.2 首页仪表盘

#### 2.2.1 功能描述

首页仪表盘是用户进入应用后的主界面，集中展示当前环境状态和提供快捷操作入口。

#### 2.2.2 功能要点

- 显示当前激活的 Profile 名称
- 显示当前 Java、Node、Maven 配置状态
- 显示关联的 AEM 实例状态（运行中/已停止）
- 提供 Profile 快速切换下拉菜单
- 提供快捷操作按钮（扫描环境、新建配置、添加实例、打开终端）

### 2.3 环境配置管理 (Profile)

#### 2.3.1 功能描述

Profile 是本产品的核心概念，代表一套完整的开发环境配置。用户可以为不同项目创建不同的 Profile。

#### 2.3.2 Profile 包含内容

| 配置项 | 必填 | 说明 |
|--------|------|------|
| 名称 | 是 | Profile 的显示名称 |
| 描述 | 否 | 对此环境的说明 |
| 图标颜色 | 否 | 用于视觉区分 |
| Java 版本 | 否 | 关联的 Java 版本 |
| Node 版本 | 否 | 关联的 Node 版本 |
| Maven 配置 | 否 | 关联的 Maven settings.xml |
| AEM 实例 | 否 | 关联的 AEM 实例（可多选） |
| 项目目录 | 否 | 关联的项目工作目录 |
| 环境变量 | 否 | 自定义环境变量 |

#### 2.3.3 操作功能

- 新建 Profile
- 编辑 Profile
- 删除 Profile
- 复制 Profile
- 切换到指定 Profile
- 导入/导出 Profile

### 2.4 AEM 实例管理

#### 2.4.1 功能描述

管理本地 AEM 实例的配置、启动、停止，并实时显示实例状态和版本信息。

#### 2.4.2 实例配置项

| 配置项 | 必填 | 说明 |
|--------|------|------|
| 实例名称 | 是 | 显示名称 |
| 实例类型 | 是 | Author / Publish |
| URL | 是 | 实例访问地址（如 http://localhost:4502） |
| 用户名 | 是 | 登录用户名 |
| 密码 | 是 | 登录密码（加密存储） |
| JAR 路径 | 否 | AEM quickstart JAR 文件路径 |
| 运行目录 | 否 | AEM 实例运行目录 |
| JVM 参数 | 否 | 启动时的 JVM 参数 |

#### 2.4.3 显示信息

- 运行状态（运行中/已停止/未知）
- AEM 版本号
- AEM 类型（Cloud Service / 6.5 等）
- 运行时间
- Java 版本
- Oak 版本

#### 2.4.4 操作功能

- 启动实例
- 停止实例
- 重启实例
- 刷新状态
- 快捷入口：打开 CRXDE Lite
- 快捷入口：打开包管理器
- 快捷入口：打开系统控制台

### 2.5 Java 版本管理

#### 2.5.1 功能描述

扫描系统中已安装的 Java 版本，并提供切换功能。支持集成 SDKMAN、jEnv 等版本管理工具。

#### 2.5.2 功能要点

- 扫描指定目录下的 Java 安装
- 显示版本号和安装路径
- 切换当前 Java 版本
- 支持手动添加 Java 路径
- 集成 SDKMAN（macOS）/ jabba（Windows）
- 设置默认 Java 版本

### 2.6 Node 版本管理

#### 2.6.1 功能描述

扫描系统中已安装的 Node.js 版本，并提供切换功能。支持集成 nvm、fnm 等版本管理工具。

#### 2.6.2 功能要点

- 扫描 nvm/fnm 管理的 Node 版本
- 显示版本号和安装路径
- 切换当前 Node 版本
- 支持手动添加 Node 路径
- 集成 nvm（macOS）/ nvm-windows（Windows）
- 设置默认 Node 版本

### 2.7 Maven 配置管理

#### 2.7.1 功能描述

管理多套 Maven settings.xml 配置文件，支持一键切换。

#### 2.7.2 功能要点

- 配置文件列表管理
- 切换当前生效的 settings.xml
- 切换时自动备份原配置
- 新建配置文件
- 编辑配置文件
- 删除配置文件

### 2.8 首次使用向导

#### 2.8.1 功能描述

用户首次启动应用时，通过 5 步向导引导完成初始化配置。

#### 2.8.2 向导步骤

| 步骤 | 名称 | 内容 |
|------|------|------|
| 1 | 环境扫描 | 自动扫描系统中的 Java、Node、Maven、AEM 实例 |
| 2 | Java 配置 | 确认扫描到的 Java 版本，选择管理工具，设置默认版本 |
| 3 | Node 配置 | 确认扫描到的 Node 版本，选择管理工具，设置默认版本 |
| 4 | Maven 配置 | 确认 Maven 路径，添加配置文件 |
| 5 | AEM 实例 | 添加 AEM 实例（可跳过） |

### 2.9 全局设置

#### 2.9.1 路径配置

- Java 扫描目录
- Node 扫描目录
- Maven 安装路径
- Maven 配置文件目录

#### 2.9.2 环境同步设置

- 启动时自动检测（默认关闭）
- 后台定时检测（默认关闭）
- 检测间隔设置

#### 2.9.3 版本管理工具

- Java: SDKMAN / jEnv / jabba / 手动
- Node: nvm / fnm / volta / 手动

### 2.10 数据管理

#### 2.10.1 导出配置

- 选择要导出的内容（Profile、AEM实例、版本信息等）
- 导出为 ZIP 文件
- 密码以加密形式导出

#### 2.10.2 导入配置

- 从备份文件恢复
- 支持合并模式和覆盖模式
- 导入前预览内容

#### 2.10.3 重置设置

- 仅重置设置页选项为默认值
- 不影响 Profile 和实例配置

#### 2.10.4 完全重置

- 清除所有数据，恢复到首次使用状态
- 需要多重确认（输入确认词 + 勾选确认框）
- 操作不可撤销

---

## 3. 用户流程

### 3.1 首次使用流程

1. 用户首次启动应用
2. 系统检测到首次使用，启动初始化向导
3. Step 1: 自动扫描系统环境
4. Step 2: 用户确认 Java 配置
5. Step 3: 用户确认 Node 配置
6. Step 4: 用户配置 Maven
7. Step 5: 用户添加 AEM 实例（可跳过）
8. 完成初始化，进入主界面

### 3.2 切换环境流程

1. 用户选择目标 Profile
2. 系统验证目标 Profile 的依赖是否存在
3. 若存在问题，显示冲突提示，让用户选择替代方案
4. 若无问题，显示切换确认对话框
5. 用户确认后，系统执行切换
6. 切换 Java 版本
7. 切换 Node 版本
8. 切换 Maven 配置
9. （可选）启动/停止 AEM 实例
10. 切换完成，刷新主界面

### 3.3 环境扫描流程

1. 用户手动点击扫描按钮
2. 系统扫描配置的路径
3. 对比已注册版本与实际环境
4. 显示扫描结果（新发现/已失效）
5. 用户选择是否应用变更

---

## 4. 非功能需求

### 4.1 性能要求

- 应用启动时间 < 3 秒
- 环境切换时间 < 5 秒（不含 AEM 启动时间）
- 环境扫描时间 < 10 秒
- 内存占用 < 200MB

### 4.2 兼容性要求

#### 4.2.1 操作系统

- macOS 11.0 (Big Sur) 及以上
- Windows 10 及以上

#### 4.2.2 AEM 版本

- AEM 6.5.x
- AEM as a Cloud Service

### 4.3 安全要求

- 密码等敏感信息加密存储
- 导出文件中的密码加密
- 不上传任何用户数据到云端

### 4.4 可用性要求

- 界面简洁直观，新用户无需培训即可上手
- 操作有明确的反馈（成功/失败提示）
- 危险操作有确认机制
- 支持中英文界面

---

## 5. 约束与假设

### 5.1 约束条件

- 本工具仅管理本地开发环境，不涉及远程服务器
- 需要用户预先安装 Java、Node、Maven 等工具
- AEM 实例需要用户自行准备

### 5.2 假设条件

- 用户具备基本的 AEM 开发知识
- 用户了解 Java、Node、Maven 的基本概念
- 用户的开发机器有足够的资源运行 AEM 实例

---

## 6. 术语表

| 术语 | 说明 |
|------|------|
| AEM | Adobe Experience Manager，Adobe 的企业级内容管理系统 |
| Profile | 环境配置文件，包含 Java、Node、Maven、AEM 实例等配置 |
| SDKMAN | macOS/Linux 上的 Java 版本管理工具 |
| nvm | Node Version Manager，Node.js 版本管理工具 |
| Maven | Java 项目构建工具 |
| settings.xml | Maven 的配置文件 |
| CRXDE Lite | AEM 内置的内容仓库开发环境 |
| Author | AEM 作者实例，用于内容创作 |
| Publish | AEM 发布实例，用于内容发布 |
